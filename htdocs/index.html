<!DOCTYPE html>
<html>
    <head>
        <title>Bitcoin Price Tracker (INR)</title>
        <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <style type="text/css">
            #openLink {
                position: fixed;
                bottom: 0;
                right: 10px;
                text-decoration: none;
            }
        </style>
    </head>

    <body>
        <!-- Plotly chart will be drawn inside this DIV -->
        <div id="zebpay-bitcoin-graph"></div>
        <br>
        <br>
        <div id="coinome-bitcoin-graph"></div>
        <br>
        <br>
        <div id="coinome-litecoin-graph"></div>
        <br>
        <br>
        <div id="coinome-bitcash-graph"></div>
        <br>
        <br>
        <a id="openLink" href="https://github.com/xRahul/price-tracker" title="Price Tracker">
            Open Source
        </a>

        <script>

            var BITCOIN = 'bitcoin';
            var BITCASH = 'bitcash';
            var LITECOIN = 'litecoin';
            var ZEBPAY = 'zebpay';
            var COINOME = 'coinome';
            var DATE_PRICE_KEY = 'Date';
            var BUY_PRICE_KEY = 'Buy';
            var SELL_PRICE_KEY = 'Sell';
            var CSV_FILENAME_SUFFIX = 'PriceData.csv';
            var WEB_HOME = 'http://zgraph.unaux.com';
            var API_DATA_PATH = '/api/data/';

            var selectorOptions = {
                buttons: [{
                    step: 'month',
                    stepmode: 'backward',
                    count: 3,
                    label: '3M'
                }, {
                    step: 'month',
                    stepmode: 'backward',
                    count: 1,
                    label: '1M'
                }, {
                    step: 'week',
                    stepmode: 'backward',
                    count: 2,
                    label: '2w'
                }, {
                    step: 'week',
                    stepmode: 'backward',
                    count: 1,
                    label: '1w'
                }, {
                    step: 'day',
                    stepmode: 'backward',
                    count: 3,
                    label: '3d'
                }, {
                    step: 'day',
                    stepmode: 'backward',
                    count: 1,
                    label: '1d'
                }, {
                    step: 'hour',
                    stepmode: 'backward',
                    count: 12,
                    label: '12h'
                }, {
                    step: 'hour',
                    stepmode: 'backward',
                    count: 6,
                    label: '6h'
                }, {
                    step: 'hour',
                    stepmode: 'backward',
                    count: 2,
                    label: '2h'
                }, {
                    step: 'minute',
                    stepmode: 'backward',
                    count: 30,
                    label: '30m'
                }, {
                    step: 'all',
                }],
            };

            var firstUpperCase = function(str) {
                str.charAt(0).toUpperCase() + str.slice(1)
            }

            Plotly.d3.csv(
                WEB_HOME + API_DATA_PATH + COINOME + firstUpperCase(BITCOIN),
                function(err, rows) {

                    function unpack(rows, key) {
                        return rows.map(function(row) { return row[key]; });
                    }

                    var trace1 = {
                        type: "scatter",
                        mode: "lines",
                        name: BUY_PRICE_KEY,
                        x: unpack(rows, DATE_PRICE_KEY),
                        y: unpack(rows, BUY_PRICE_KEY),
                        line: { color: '#17BECF' }
                    }

                    var trace2 = {
                        type: "scatter",
                        mode: "lines",
                        name: SELL_PRICE_KEY,
                        x: unpack(rows, DATE_PRICE_KEY),
                        y: unpack(rows, SELL_PRICE_KEY),
                        line: { color: '#7F7F7F' }
                    }

                    var data = [trace1, trace2];

                    var layout = {
                        title: firstUpperCase(COINOME) + " " + firstUpperCase(BITCOIN),
                        xaxis: {
                            rangeselector: selectorOptions,
                            rangeslider: {}
                        }
                    };

                    Plotly.newPlot(COINOME + '-' + BITCOIN + '-graph', data, layout);
                }
            );
        </script>
    </body>

</html>